# Mermaid 在线编辑器 - 需求文档

## 1. 项目概述

### 1.1 项目背景
Mermaid 是一种基于文本的图表生成工具，通过简单的语法描述即可自动生成流程图、时序图、甘特图等多种图表。本项目旨在提供一个便捷的在线 Mermaid 代码编辑器，支持实时预览、导出、协作等功能，并预留 AI 集成能力。

### 1.2 项目目标
- 提供简洁直观的 Mermaid 代码编辑体验
- 实现实时预览，所见即所得
- 支持图表导出为图片
- 提供常用编辑功能（粘贴、清空、格式化等）
- 友好的错误提示机制
- 为 AI 功能扩展预留接口

---

## 2. 功能需求

### 2.1（左侧）

| 功能 代码编辑区 | 优先级 | 描述 |
|------|--------|------|
| 代码编辑 | P0 | 支持 Mermaid 语法的高亮编辑器 |
| 粘贴功能 | P0 | 支持从剪贴板粘贴代码 |
| 清空功能 | P0 | 一键清空编辑器内容 |
| 格式化 | P1 | 对代码进行格式化/美化 |
| 撤销/重做 | P1 | 支持标准的编辑撤销重做 |
| 复制功能 | P2 | 复制代码到剪贴板 |
| 历史记录 | P2 | 保存编辑历史，支持回溯 |

### 2.2 预览区（右侧）

| 功能 | 优先级 | 描述 |
|------|--------|------|
| 实时预览 | P0 | 代码变更后自动更新预览 |
| 放大/缩小 | P0 | 支持预览图的缩放控制 |
| 重置视图 | P1 | 恢复默认缩放比例 |
| 刷新预览 | P1 | 手动触发预览更新 |

### 2.3 导出功能

| 功能 | 优先级 | 描述 |
|------|--------|------|
| 导出 PNG | P0 | 导出为 PNG 格式图片 |
| 导出 SVG | P1 | 导出为 SVG 矢量格式 |
| 导出 PDF | P2 | 导出为 PDF 文档 |

### 2.4 错误处理

| 功能 | 优先级 | 描述 |
|------|--------|------|
| 语法错误提示 | P0 | 在编辑区显示错误位置和原因 |
| 错误高亮 | P0 | 精确标记错误代码行 |
| 友好错误信息 | P1 | 将技术错误转为用户友好提示 |

### 2.5 布局功能

| 功能 | 优先级 | 描述 |
|------|--------|------|
| 分屏调整 | P1 | 支持左右分栏比例调整 |
| 主题切换 | P2 | 支持亮色/暗色主题 |
| 全屏模式 | P2 | 支持全屏编辑或预览 |

---

## 3. AI 集成规划（未来功能）

### 3.1 AI 代码改错
- **功能描述**：自动检测代码错误并提供修复建议
- **输入**：错误的 Mermaid 代码
- **输出**：修复后的代码 + 修改说明
- **触发方式**：手动触发或自动触发（检测到错误时）

### 3.2 AI 代码生成
- **功能描述**：根据自然语言描述生成 Mermaid 代码
- **输入**：用户描述（如"创建一个用户登录流程图"）
- **输出**：对应的 Mermaid 代码
- **触发方式**：独立的 AI 生成面板

### 3.3 AI 代码优化
- **功能描述**：优化现有代码结构和可读性
- **输入**：现有 Mermaid 代码
- **输出**：优化后的代码

---

## 4. 非功能性需求

### 4.1 性能需求
- 预览更新延迟 < 500ms
- 页面加载时间 < 2s
- 支持大型图表渲染

### 4.2 兼容性需求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 响应式设计，适配桌面端和移动端

### 4.3 安全性需求
- 用户代码数据本地处理（可选云端存储）
- 防止 XSS 攻击

---

## 5. 技术选型

| 模块 | 方案 | 说明 |
|------|------|------|
| 前端框架 | **Vue 3** | 组件化开发，Composition API |
| 代码编辑器 | **CodeMirror 6** | 轻量级，良好的 Vue 集成 |
| Mermaid 渲染 | **mermaid.js** | 官方渲染库 |
| 导出功能 | **html-to-image** | 图片导出，支持 PNG/SVG |
| 样式方案 | **Tailwind CSS** | 原子化 CSS，便于实现毛玻璃效果 |
| 打包工具 | **Vite** | 快速开发构建 |

### 5.1 设计风格
- **毛玻璃质感**：使用 `backdrop-filter: blur()` + 半透明背景
- **现代化界面**：圆角、阴影、渐变等设计元素
- **暗色/亮色双主题**

---

## 6. 项目里程碑

### Phase 1：基础功能
- [ ] 基础页面布局（左右分栏）
- [ ] 代码编辑器集成
- [ ] Mermaid 实时预览
- [ ] 导出 PNG/SVG 功能
- [ ] 粘贴、清空功能

### Phase 2：增强功能
- [ ] 错误提示机制
- [ ] 缩放控制
- [ ] 格式化功能
- [ ] 主题切换（暗色/亮色）
- [ ] 分栏比例调整

---

## 7. 风险与挑战

1. **大型图表性能**：复杂图表可能导致渲染卡顿，需优化渲染策略
2. **编辑器兼容性**：不同浏览器的编辑器行为差异
3. **AI 响应速度**：AI 功能需要良好的加载状态反馈
4. **错误提示准确性**：需要良好的错误定位和描述机制

---

## 8. 附录

### 8.1 参考产品
- [Mermaid Live Editor](https://mermaid.live/) - 官方在线编辑器
- [Draw.io](https://draw.io/) - 在线图表工具

### 8.2 术语说明
- **Mermaid**：一种基于文本的图表定义语言
- **SVG**：可缩放矢量图形
- **PNG**：便携式网络图形格式

---

*文档版本：v1.0*
*创建日期：2026-01-07*
